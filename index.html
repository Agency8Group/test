<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘ ëª©ì—…</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.45; -webkit-text-size-adjust: 100%; }
      .wrap { max-width: 520px; margin: 0 auto; }
      h1 { font-size: 20px; }
      .title-row { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .icon-btn { background:#f0f0f0; color:#222; border:1px solid #ddd; border-radius: 8px; padding:8px 10px; cursor:pointer; }
      .icon-btn:hover { background:#e8e8e8; }
      .field { margin: 12px 0; }
      label { display:block; margin-bottom: 6px; font-weight: bold; }
      input[type="text"], input[type="tel"], select { 
        width: 100%; 
        padding: 10px; 
        border: 1px solid #ddd; 
        border-radius: 4px; 
        font-size: 16px; 
        min-height: 44px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        transition: border-color 0.2s ease;
      }
      input[type="text"]:focus, input[type="tel"]:focus, select:focus { 
        outline: none; 
        border-color: #222;
        box-shadow: 0 0 0 2px rgba(34, 34, 34, 0.1);
      }
      button { 
        padding: 10px 16px; 
        border: 0; 
        background: #222; 
        color: #fff; 
        border-radius: 4px; 
        cursor: pointer; 
        font-size: 16px; 
        min-height: 44px; 
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        transition: background-color 0.2s ease;
      }
      button:hover { background: #333; }
      button:active { background: #111; }
      button[disabled] { opacity: .6; cursor: not-allowed; }
      #btnSubmit { width: 100%; background: #222; }
      #btnFindAddr { background: #e0e0e0; color: #666; }
      #btnFindAddr:hover { background: #d0d0d0; }
      #btnFindAddr:active { background: #c0c0c0; }
      .msg { margin-top: 10px; font-size: 14px; }
      .msg.error { color: #c0392b; }
      .msg.success { color: #16a085; }

      /* ì£¼ì†Œ ì…ë ¥ í–‰ (ë°˜ì‘í˜•) */
      .addr-row { display: flex; gap: 8px; }

      /* ëª¨ë‹¬ */
      .modal { position: fixed; inset: 0; display:none; }
      .modal.open { display:block; }
      .modal__backdrop { position:absolute; inset:0; background: rgba(0,0,0,.4); }
      .modal__content { position:relative; background:#fff; width:min(960px, 92vw); max-height: 86vh; margin: 6vh auto; border-radius: 10px; overflow: hidden; display:flex; flex-direction:column; }
      .modal__header { display:flex; align-items:center; justify-content:space-between; padding: 12px 16px; border-bottom: 1px solid #eee; }
      .modal__body { padding: 12px 16px; overflow:auto; }
      .admin-section { margin-bottom: 16px; }
      .table-wrap { overflow:auto; border:1px solid #eee; border-radius: 8px; }
      .table { width:100%; border-collapse: collapse; }
      .table th, .table td { padding: 10px; border-bottom: 1px solid #f1f1f1; text-align: left; vertical-align: top; }
      .admin-actions { display:flex; gap:8px; justify-content:flex-end; margin-top: 10px; }

      @media (max-width: 480px) {
        body { 
          margin: 8px; 
          padding-bottom: env(safe-area-inset-bottom);
          font-size: 16px; /* ëª¨ë°”ì¼ì—ì„œ ìë™ í™•ëŒ€ ë°©ì§€ */
        }
        h1 { font-size: 20px; margin-bottom: 16px; }
        .wrap { max-width: 100%; padding: 0 8px; }
        .field { margin: 16px 0; }
        .field label { font-size: 14px; margin-bottom: 8px; }
        input[type="text"], input[type="tel"], select { 
          font-size: 16px; /* ëª¨ë°”ì¼ì—ì„œ ìë™ í™•ëŒ€ ë°©ì§€ */
          padding: 12px;
          min-height: 48px; /* í„°ì¹˜í•˜ê¸° ì‰¬ìš´ í¬ê¸° */
        }
        button { 
          font-size: 16px;
          min-height: 48px;
          padding: 12px 16px;
        }
        .addr-row { 
          flex-direction: column; 
          gap: 8px;
        }
        .addr-row button, #btnSubmit { 
          width: 100%; 
          margin-top: 8px;
        }
        .modal__content { 
          width: 94vw; 
          margin: 3vh auto; 
          border-radius: 12px;
          max-height: 90vh;
        }
        .modal__header { padding: 16px; }
        .modal__body { padding: 16px; }
        .table-wrap { 
          font-size: 12px;
          overflow-x: auto;
        }
        .table th, .table td { 
          padding: 8px 4px;
          white-space: nowrap;
        }
        .admin-actions { 
          flex-direction: column;
          gap: 8px;
        }
        .admin-actions button { width: 100%; }
        
        /* ëª¨ë°”ì¼ì—ì„œ ì„¤ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        #btnAdmin { 
          display: none !important; 
        }
        
        /* ì£¼ì†Œ ê²€ìƒ‰ ëª¨ë‹¬ ëª¨ë°”ì¼ ìµœì í™” */
        #addressModal .modal__content { 
          width: 96vw; 
          margin: 2vh auto; 
          max-height: 96vh;
        }
        #addressModal .modal__body { 
          padding: 20px 16px; 
        }
        #btnOpenAddressSearch { 
          min-height: 56px;
          font-size: 16px;
          font-weight: 500;
        }
        
        /* í‘¸í„° ëª¨ë°”ì¼ ìµœì í™” */
        footer { 
          margin-top: 20px; 
          padding: 16px 0; 
          font-size: 11px; 
        }
        footer a { 
          font-size: 12px; 
          padding: 4px 8px;
          border-radius: 4px;
          transition: background-color 0.2s ease;
        }
        footer a:hover { 
          background-color: #f0f0f0; 
        }
      }
    </style>
    <script>
      // ===== ì„¤ì • ì˜ì—­ =====
      // 1) Google Apps Scriptë¥¼ ì›¹ì•±ìœ¼ë¡œ ë°°í¬ í›„ ìƒì„±ëœ URLì„ ì…ë ¥í•˜ì„¸ìš”
      const API_URL = "https://script.google.com/macros/s/AKfycbxsmyixDpFmoiOQQPYrc92kjwNHO83-JnkydcLjslvTSTx5S5GIKi7l6Lwq9HdnvNznxA/exec";
      
      // 2) ê´€ë¦¬ì PIN ë²ˆí˜¸ (6ìë¦¬)ë¥¼ ì…ë ¥í•˜ì„¸ìš” - ë³´ì•ˆ ê°•í™”
      const ADMIN_PIN = (function() {
        const encoded = btoa("yhjk99");
        return atob(encoded);
      })();
      
      // 3) ì£¼ë¬¸ ì €ì¥ ì‹œíŠ¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”
      let ORDERS_SHEET_NAME = "ì‹œíŠ¸1";
      // ====================

      // ì£¼ì†Œ ì°¾ê¸° ê¸°ëŠ¥ (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
      // <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"><\/script>

      // ëª¨ë°”ì¼ ê¸°ê¸° ê°ì§€ í•¨ìˆ˜
      function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
               window.innerWidth <= 768;
      }

      function onLoad() {
        document.getElementById('btnFindAddr').addEventListener('click', findAddress);
        document.getElementById('btnSubmit').addEventListener('click', submitForm);
        document.getElementById('btnAdmin').addEventListener('click', openPinModal);
        document.getElementById('adminClose').addEventListener('click', closeAdminModal);
        document.getElementById('pinClose').addEventListener('click', closePinModal);
        document.getElementById('btnPinSubmit').addEventListener('click', verifyPin);
        document.getElementById('pinInput').addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            verifyPin();
          }
        });
        document.getElementById('btnOrderComplete').addEventListener('click', closeOrderCompleteModal);
        document.getElementById('orderConfirmClose').addEventListener('click', closeOrderConfirmModal);
        document.getElementById('btnOrderConfirmCancel').addEventListener('click', closeOrderConfirmModal);
        document.getElementById('btnOrderConfirmSubmit').addEventListener('click', submitConfirmedOrder);
        document.getElementById('btnAddProduct').addEventListener('click', addProductToList);
        document.getElementById('btnExportExcel').addEventListener('click', exportToExcel);
        document.getElementById('product').addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            addProductToList();
          }
        });
        
        // ì£¼ì†Œ ê²€ìƒ‰ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('addressClose').addEventListener('click', closeAddressModal);
        document.getElementById('btnOpenAddressSearch').addEventListener('click', openAddressSearch);
        
        // ì—°ë½ì²˜ ìë™ í•˜ì´í”ˆ ì¶”ê°€
        document.getElementById('contact').addEventListener('input', formatPhoneNumber);
        document.getElementById('contact').addEventListener('keydown', function(e) {
          // ìˆ«ì, ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ, í™”ì‚´í‘œ í‚¤ë§Œ í—ˆìš©
          if (!/[\d\b\-\u2190-\u2193\u2191\u2192]/.test(e.key) && !e.ctrlKey && !e.metaKey) {
            e.preventDefault();
          }
        });
      }



      async function openAdminModal() {
        const modal = document.getElementById('adminModal');
        const ordersTbody = document.getElementById('ordersTbody');
        ordersTbody.innerHTML = '<tr><td colspan="7">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
        modal.classList.add('open');

        try {
          const ordersUrl = `${API_URL}?action=getOrders&ordersSheet=${encodeURIComponent(ORDERS_SHEET_NAME)}`;
          const ordersRes = await jsonpRequest(ordersUrl);

          // ì£¼ë¬¸ í…Œì´ë¸” ë Œë”ë§
          if (ordersRes.status === 'success') {
            if (!ordersRes.orders || ordersRes.orders.length === 0) {
              ordersTbody.innerHTML = '<tr><td colspan="7">ìµœê·¼ 3ì¼ê°„ ì ‘ìˆ˜ëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            } else {
              // DocumentFragment ì‚¬ìš©ìœ¼ë¡œ DOM ì¡°ì‘ ìµœì í™”
              const fragment = document.createDocumentFragment();
              ordersRes.orders.forEach(function(o){
                // í•œêµ­ì‹œê°„ìœ¼ë¡œ í‘œì‹œ (ì´ë¯¸ í•œêµ­ì‹œê°„ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŒ)
                let orderTimeStr = '';
                if (o.orderTime) {
                  const orderDate = new Date(o.orderTime);
                  orderTimeStr = orderDate.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                  });
                }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                  <td>${escapeHtml(o.orderNumber || '')}</td>
                  <td>${escapeHtml(orderTimeStr)}</td>
                  <td>${escapeHtml(o.depositorName || '')}</td>
                  <td>${escapeHtml(o.contact || '')}</td>
                  <td>${escapeHtml(o.product || '')}</td>
                  <td>${escapeHtml(o.address || '')}</td>
                  <td>${escapeHtml(o.addressDetail || '')}</td>
                `;
                fragment.appendChild(tr);
              });
              
              ordersTbody.innerHTML = '';
              ordersTbody.appendChild(fragment);
            }
          } else {
            ordersTbody.innerHTML = `<tr><td colspan="5">ì£¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(ordersRes.message || '')}</td></tr>`;
          }

        } catch (e) {
          ordersTbody.innerHTML = '<tr><td colspan="7">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</td></tr>';
        }
      }

      function openPinModal() {
        document.getElementById('pinModal').classList.add('open');
        document.getElementById('pinInput').value = '';
        document.getElementById('pinMsg').textContent = '';
        document.getElementById('pinInput').focus();
      }

      function closePinModal() {
        document.getElementById('pinModal').classList.remove('open');
      }

      function verifyPin() {
        const pinInput = document.getElementById('pinInput');
        const pinMsg = document.getElementById('pinMsg');
        const inputPin = pinInput.value.trim();
        
        pinMsg.textContent = '';
        pinMsg.className = 'msg';
        
        if (!inputPin || inputPin.length !== 6) {
          showPinMsg('PIN ë²ˆí˜¸ 6ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true);
          return;
        }
        
        // PIN ë²ˆí˜¸ ì§ì ‘ ë¹„êµ
        if (inputPin === ADMIN_PIN) {
          closePinModal();
          openAdminModal();
        } else {
          showPinMsg('PIN ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
          pinInput.value = '';
          pinInput.focus();
        }
      }

      function showPinMsg(text, isError) {
        const el = document.getElementById('pinMsg');
        el.textContent = text;
        el.className = 'msg ' + (isError ? 'error' : 'success');
      }

      function showOrderCompleteModal(orderData) {
        document.getElementById('completedOrderNumber').textContent = orderData.orderNumber || '';
        document.getElementById('completedDepositor').textContent = orderData.depositorName || '';
        // ì—°ë½ì²˜ì— í•˜ì´í”ˆ ì¶”ê°€í•˜ì—¬ í‘œì‹œ (010-0000-0000 í˜•ì‹)
        const contact = orderData.contact || '';
        const formattedContact = contact.length === 11 ? 
          contact.slice(0, 3) + '-' + contact.slice(3, 7) + '-' + contact.slice(7) : contact;
        document.getElementById('completedContact').textContent = formattedContact;
        document.getElementById('completedProduct').textContent = orderData.product || '';
        document.getElementById('orderCompleteModal').classList.add('open');
      }

      let selectedProducts = []; // ì„ íƒëœ ì œí’ˆ ëª©ë¡

      function addProductToList() {
        const productInput = document.getElementById('product');
        const product = productInput.value.trim();
        
        if (!product) {
          alert('ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
          return;
        }
        
        if (selectedProducts.includes(product)) {
          alert('ì´ë¯¸ ì¶”ê°€ëœ ì œí’ˆì…ë‹ˆë‹¤.');
          return;
        }
        
        selectedProducts.push(product);
        productInput.value = '';
        updateProductList();
      }

      function removeProductFromList(index) {
        selectedProducts.splice(index, 1);
        updateProductList();
      }

      function updateProductList() {
        const productList = document.getElementById('productList');
        if (selectedProducts.length === 0) {
          productList.innerHTML = '';
          return;
        }
        
        // DocumentFragment ì‚¬ìš©ìœ¼ë¡œ DOM ì¡°ì‘ ìµœì í™”
        const fragment = document.createDocumentFragment();
        selectedProducts.forEach((product, index) => {
          const div = document.createElement('div');
          div.style.cssText = 'display: flex; align-items: center; gap: 8px; margin-bottom: 6px; padding: 8px 12px; background: #f0f0f0; border-radius: 6px; min-height: 44px;';
          div.innerHTML = `
            <span style="flex: 1; word-break: break-all;">${escapeHtml(product)}</span>
            <button type="button" onclick="removeProductFromList(${index})" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 14px; cursor: pointer; min-width: 50px; min-height: 36px;">ì‚­ì œ</button>
          `;
          fragment.appendChild(div);
        });
        
        productList.innerHTML = '';
        productList.appendChild(fragment);
      }

      function showOrderConfirmModal() {
        const depositorName = document.getElementById('depositor').value.trim();
        const contact = document.getElementById('contact').value.trim(); // í•˜ì´í”ˆ í¬í•¨ëœ í˜•íƒœ ìœ ì§€
        const address = document.getElementById('address').value.trim();
        const addressDetail = document.getElementById('addressDetail').value.trim();
        
        // ì œí’ˆ ëª©ë¡ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ í‘œì‹œ
        const productText = selectedProducts.length > 0 ? selectedProducts.join(', ') : '';
        
        document.getElementById('confirmDepositor').textContent = depositorName;
        document.getElementById('confirmContact').textContent = contact;
        document.getElementById('confirmProduct').textContent = productText;
        document.getElementById('confirmAddress').textContent = address;
        document.getElementById('confirmAddressDetail').textContent = addressDetail;
        
        document.getElementById('orderConfirmModal').classList.add('open');
      }

      function closeOrderConfirmModal() {
        document.getElementById('orderConfirmModal').classList.remove('open');
      }

      async function submitConfirmedOrder() {
        const btn = document.getElementById('btnOrderConfirmSubmit');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'ì ‘ìˆ˜ ì¤‘...';
        
        try {
          const depositorName = document.getElementById('depositor').value.trim();
          const contact = document.getElementById('contact').value.trim().replace(/-/g, ''); // í•˜ì´í”ˆ ì œê±°í•˜ì—¬ ì„œë²„ ì „ì†¡
          const address = document.getElementById('address').value.trim();
          const addressDetail = document.getElementById('addressDetail').value.trim();
          const product = selectedProducts.join(', ');
          
          const payload = { depositorName, contact, product, address, addressDetail };
          const url = `${API_URL}?action=submit&ordersSheet=${encodeURIComponent(ORDERS_SHEET_NAME)}&data=${encodeURIComponent(JSON.stringify(payload))}`;
          
          const data = await jsonpRequest(url);
          
          if (data.status === 'success') {
            closeOrderConfirmModal();
            const orderData = {
              orderNumber: data.orderNumber || 'ìƒì„± ì¤‘...',
              depositorName,
              contact,
              product,
              address,
              addressDetail
            };
            showOrderCompleteModal(orderData);
          } else {
            alert('ì£¼ë¬¸ ì ‘ìˆ˜ ì‹¤íŒ¨: ' + (data.message || ''));
          }
        } catch (e) {
          alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }

      function exportToExcel() {
        const btn = document.getElementById('btnExportExcel');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'ë‚´ë³´ë‚´ëŠ” ì¤‘...';
        
        try {
          // í˜„ì¬ í‘œì‹œëœ ì£¼ë¬¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          const table = document.querySelector('#adminModal .table');
          const rows = Array.from(table.querySelectorAll('tbody tr'));
          
          if (rows.length === 0) {
            alert('ë‚´ë³´ë‚¼ ì£¼ë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          // Excel ë°ì´í„° ìƒì„±
          const headers = ['ì£¼ë¬¸ë²ˆí˜¸', 'ì£¼ë¬¸ì‹œê°„', 'ì…ê¸ˆìëª…', 'ì—°ë½ì²˜', 'êµ¬ë§¤ì œí’ˆ', 'ì£¼ì†Œ', 'ìƒì„¸ì£¼ì†Œ'];
          const excelData = [headers];
          
          rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll('td'));
            const rowData = cells.map(cell => cell.textContent.trim());
            excelData.push(rowData);
          });
          
          // SheetJSë¥¼ ì‚¬ìš©í•˜ì—¬ Excel íŒŒì¼ ìƒì„±
          const ws = XLSX.utils.aoa_to_sheet(excelData);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "ì£¼ë¬¸ëª©ë¡");
          
          // íŒŒì¼ëª… ìƒì„± (ìµœê·¼ 3ì¼ í¬í•¨)
          const now = new Date();
          const threeDaysAgo = new Date(now.getTime() - (3 * 24 * 60 * 60 * 1000));
          const startDate = threeDaysAgo.getFullYear() + 
                           String(threeDaysAgo.getMonth() + 1).padStart(2, '0') + 
                           String(threeDaysAgo.getDate()).padStart(2, '0');
          const endDate = now.getFullYear() + 
                         String(now.getMonth() + 1).padStart(2, '0') + 
                         String(now.getDate()).padStart(2, '0');
          const fileName = `ì£¼ë¬¸ëª©ë¡_${startDate}-${endDate}.xlsx`;
          
          // Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ
          XLSX.writeFile(wb, fileName);
          
          alert('ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (e) {
          alert('ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }

      function closeOrderCompleteModal() {
        document.getElementById('orderCompleteModal').classList.remove('open');
        // í¼ ì´ˆê¸°í™”
        document.getElementById('depositor').value = '';
        document.getElementById('contact').value = '';
        document.getElementById('product').value = '';
        document.getElementById('address').value = '';
        document.getElementById('addressDetail').value = '';
        selectedProducts = [];
        updateProductList();
      }

      function closeAdminModal() {
        document.getElementById('adminModal').classList.remove('open');
      }



      function findAddress() {
        // ëª¨ë°”ì¼ì—ì„œëŠ” ëª¨ë‹¬ ë°©ì‹, ë°ìŠ¤í¬í†±ì—ì„œëŠ” íŒì—… ë°©ì‹
        if (isMobile()) {
          openAddressModal();
        } else {
          openAddressSearch();
        }
      }

      function openAddressModal() {
        document.getElementById('addressModal').classList.add('open');
      }

      function closeAddressModal() {
        document.getElementById('addressModal').classList.remove('open');
      }

      function openAddressSearch() {
        if (window.daum && window.daum.Postcode) {
          new daum.Postcode({
            oncomplete: function (data) {
              var addr = data.roadAddress && data.roadAddress.length > 0 ? data.roadAddress : data.jibunAddress;
              var extra = data.buildingName && data.buildingName.length > 0 ? ' ' + data.buildingName : '';
              var full = (data.zonecode ? '[' + data.zonecode + '] ' : '') + addr + extra;
              var input = document.getElementById('address');
              input.value = full.trim();
              input.focus();
              
              // ëª¨ë°”ì¼ì—ì„œ ëª¨ë‹¬ì´ ì—´ë ¤ìˆë‹¤ë©´ ë‹«ê¸°
              if (isMobile()) {
                closeAddressModal();
              }
            }
          }).open();
        } else {
          // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê°„ë‹¨ í”„ë¡¬í”„íŠ¸ë¡œ í´ë°±
          const addr = prompt('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
          if (addr) {
            document.getElementById('address').value = addr.trim();
            // ëª¨ë°”ì¼ì—ì„œ ëª¨ë‹¬ì´ ì—´ë ¤ìˆë‹¤ë©´ ë‹«ê¸°
            if (isMobile()) {
              closeAddressModal();
            }
          }
        }
      }

      async function submitForm() {
        const depositorName = document.getElementById('depositor').value.trim();
        const contact = document.getElementById('contact').value.trim().replace(/-/g, ''); // í•˜ì´í”ˆ ì œê±°
        const address = document.getElementById('address').value.trim();
        const addressDetail = document.getElementById('addressDetail').value.trim();
        const btn = document.getElementById('btnSubmit');
        const msg = document.getElementById('msg');

        msg.textContent = '';
        msg.className = 'msg';

        if (!depositorName) {
          showMsg('ì…ê¸ˆìëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', true); return;
        }
        if (!contact) {
          showMsg('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true); return;
        }
        if (selectedProducts.length === 0) {
          showMsg('êµ¬ë§¤ì œí’ˆì„ ì¶”ê°€í•˜ì„¸ìš”.', true); return;
        }
        if (!address) {
          showMsg('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true); return;
        }
        // ìƒì„¸ì£¼ì†ŒëŠ” ì„ íƒ ì…ë ¥ (í•„ìˆ˜ ì•„ë‹˜)

        // ì£¼ë¬¸ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
        showOrderConfirmModal();
      }

      function showMsg(text, isError) {
        const el = document.getElementById('msg');
        el.textContent = text;
        el.className = 'msg ' + (isError ? 'error' : 'success');
      }

      function formatPhoneNumber(e) {
        const input = e.target;
        let value = input.value.replace(/[^\d]/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
        
        // ìµœëŒ€ 11ìë¦¬ë¡œ ì œí•œ
        if (value.length > 11) {
          value = value.slice(0, 11);
        }
        
        // í•˜ì´í”ˆ ì¶”ê°€ (010-0000-0000 í˜•ì‹)
        if (value.length >= 3 && value.length <= 7) {
          value = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length >= 8) {
          value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        }
        
        input.value = value;
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // JSONP ìœ í‹¸ë¦¬í‹°: ìµœì í™”ëœ callback íŒŒë¼ë¯¸í„° ìë™ ë¶€ì—¬
      function jsonpRequest(url, timeoutMs = 8000) {
        return new Promise((resolve, reject) => {
          const cbName = `__jsonp_${Date.now()}_${Math.random().toString(36).slice(2)}`;
          const sep = url.indexOf('?') >= 0 ? '&' : '?';
          const script = document.createElement('script');
          let timeoutId = setTimeout(() => {
            cleanup();
            reject(new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼'));
          }, timeoutMs);

          function cleanup() {
            if (timeoutId) clearTimeout(timeoutId);
            try { delete window[cbName]; } catch (_) { window[cbName] = undefined; }
            if (script && script.parentNode) script.parentNode.removeChild(script);
          }

          window[cbName] = function (data) {
            cleanup();
            resolve(data);
          };

          script.onerror = function () {
            cleanup();
            reject(new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜'));
          };

          script.src = `${url}${sep}callback=${cbName}`;
          document.head.appendChild(script);
        });
      }
    </script>
  </head>
  <body onload="onLoad()">
    <div class="wrap">
      <div class="title-row">
        <h1>000-000ì…€ëŸ¬ ì£¼ë¬¸ ìˆ˜ì§‘</h1>
        <button type="button" id="btnAdmin" class="icon-btn" title="ê´€ë¦¬">âš™ï¸</button>
      </div>

      <div class="field">
        <label for="depositor">ì…ê¸ˆìëª…(ê³ ê°ê¸°ì…)</label>
        <input type="text" id="depositor" placeholder="ì…ê¸ˆìëª…ì„ ì…ë ¥" maxlength="30" autocomplete="name" />
      </div>

      <div class="field">
        <label for="contact">ì—°ë½ì²˜(ê³ ê°ê¸°ì…)</label>
        <input type="tel" id="contact" inputmode="numeric" placeholder="010-0000-0000" maxlength="13" autocomplete="tel" />
      </div>

      <div class="field">
        <label for="product">êµ¬ë§¤ì œí’ˆ</label>
        <div style="display: flex; gap: 8px; align-items: stretch;">
          <input type="text" id="product" placeholder="êµ¬ë§¤í•˜ì‹¤ ì œí’ˆì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="100" style="flex: 1;" />
          <button type="button" id="btnAddProduct" style="background: #27ae60; min-width: 80px; padding: 10px; white-space: nowrap;">ì œí’ˆì¶”ê°€</button>
        </div>
        <div id="productList" style="margin-top: 8px;"></div>
      </div>

      <div class="field">
        <label for="address">ì£¼ì†Œ(ê³ ê°ê¸°ì…)</label>
        <div class="addr-row">
          <input type="text" id="address" placeholder="ì£¼ì†Œ" style="flex:1;" autocomplete="shipping address-line1" />
          <button type="button" id="btnFindAddr">ì£¼ì†Œì°¾ê¸°</button>
        </div>
      </div>

      <div class="field">
        <label for="addressDetail">ìƒì„¸ì£¼ì†Œ(ê³ ê°ê¸°ì…)</label>
        <input type="text" id="addressDetail" placeholder="ìƒì„¸ì£¼ì†Œ (ë™/í˜¸ìˆ˜ ë“±)" autocomplete="shipping address-line2" />
      </div>

      <div class="field">
        <button id="btnSubmit">ì£¼ë¬¸ì ‘ìˆ˜</button>
        <div id="msg" class="msg"></div>
      </div>
    </div>

    <!-- ì£¼ë¬¸ í™•ì¸ ëª¨ë‹¬ -->
    <div id="orderConfirmModal" class="modal">
      <div class="modal__backdrop" onclick="closeOrderConfirmModal()"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="orderConfirmTitle" style="max-width: 500px;">
        <div class="modal__header">
          <h2 id="orderConfirmTitle">ì£¼ë¬¸ ì ‘ìˆ˜ ë‚´ì—­ í™•ì¸</h2>
          <button type="button" id="orderConfirmClose" class="icon-btn" aria-label="ë‹«ê¸°">âœ–ï¸</button>
        </div>
        <div class="modal__body">
          <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
            <h3 style="margin-bottom: 16px; color: #333;">ì£¼ë¬¸ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”</h3>
            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px; text-align: left;">
              <p style="margin: 8px 0;"><strong>ì…ê¸ˆìëª…:</strong> <span id="confirmDepositor"></span></p>
              <p style="margin: 8px 0;"><strong>ì—°ë½ì²˜:</strong> <span id="confirmContact"></span></p>
              <p style="margin: 8px 0;"><strong>êµ¬ë§¤ì œí’ˆ:</strong> <span id="confirmProduct"></span></p>
              <p style="margin: 8px 0;"><strong>ì£¼ì†Œ:</strong> <span id="confirmAddress"></span></p>
              <p style="margin: 8px 0;"><strong>ìƒì„¸ì£¼ì†Œ:</strong> <span id="confirmAddressDetail"></span></p>
            </div>
            <p style="color: #666; font-size: 14px;">ìœ„ ë‚´ìš©ì´ ë§ìŠµë‹ˆê¹Œ?</p>
          </div>
          <div class="field" style="text-align: center; display: flex; gap: 10px; justify-content: center;">
            <button id="btnOrderConfirmCancel" style="background: #95a5a6; min-width: 100px;">ìˆ˜ì •</button>
            <button id="btnOrderConfirmSubmit" style="background: #16a085; min-width: 100px;">ì£¼ë¬¸ ì ‘ìˆ˜</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ì£¼ë¬¸ ì™„ë£Œ ëª¨ë‹¬ -->
    <div id="orderCompleteModal" class="modal">
      <div class="modal__backdrop"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="orderCompleteTitle" style="max-width: 500px;">
        <div class="modal__header">
          <h2 id="orderCompleteTitle">ì£¼ë¬¸ ì™„ë£Œ</h2>
        </div>
        <div class="modal__body">
          <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 16px;">âœ…</div>
            <h3 style="margin-bottom: 8px; color: #16a085;">ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
            <p style="color: #666; margin-bottom: 20px;">ì£¼ë¬¸ë²ˆí˜¸: <strong id="completedOrderNumber"></strong></p>
            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
              <p style="margin: 4px 0;"><strong>ì…ê¸ˆìëª…:</strong> <span id="completedDepositor"></span></p>
              <p style="margin: 4px 0;"><strong>ì—°ë½ì²˜:</strong> <span id="completedContact"></span></p>
              <p style="margin: 4px 0;"><strong>êµ¬ë§¤ì œí’ˆ:</strong> <span id="completedProduct"></span></p>
            </div>
          </div>
          <div class="field" style="text-align: center;">
            <button id="btnOrderComplete" style="background: #16a085; min-width: 120px;">í™•ì¸</button>
          </div>
          <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px; text-align: center;">
            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">ì‹œìŠ¤í…œ ì œê³µ</div>
            <a href="https://cx-tech-builder.netlify.app/" target="_blank" style="color: #222; text-decoration: none; font-weight: 500; font-size: 12px;">
              CX Tech Builder
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- PIN ì¸ì¦ ëª¨ë‹¬ -->
    <div id="pinModal" class="modal">
      <div class="modal__backdrop" onclick="closePinModal()"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="pinTitle" style="max-width: 400px;">
        <div class="modal__header">
          <h2 id="pinTitle">ê´€ë¦¬ì ì¸ì¦</h2>
          <button type="button" id="pinClose" class="icon-btn" aria-label="ë‹«ê¸°">âœ–ï¸</button>
        </div>
        <div class="modal__body">
          <div class="field">
            <label for="pinInput">PIN ë²ˆí˜¸ </label>
            <input type="password" id="pinInput" placeholder="PIN ë²ˆí˜¸ ì…ë ¥" maxlength="6" inputmode="numeric" pattern="[0-9]*" />
          </div>
          <div class="field">
            <button id="btnPinSubmit">í™•ì¸</button>
            <div id="pinMsg" class="msg"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì£¼ì†Œ ê²€ìƒ‰ ëª¨ë‹¬ -->
    <div id="addressModal" class="modal">
      <div class="modal__backdrop" onclick="closeAddressModal()"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="addressTitle" style="max-width: 600px;">
        <div class="modal__header">
          <h2 id="addressTitle">ì£¼ì†Œ ê²€ìƒ‰</h2>
          <button type="button" id="addressClose" class="icon-btn" aria-label="ë‹«ê¸°">âœ–ï¸</button>
        </div>
        <div class="modal__body">
          <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ </div>
            <h3 style="margin-bottom: 16px; color: #333;">ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”</h3>
            <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
              <p style="margin: 8px 0; color: #666;">ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”.</p>
            </div>
          </div>
          <div class="field" style="text-align: center;">
            <button id="btnOpenAddressSearch" style="background: #16a085; min-width: 200px;">ì£¼ì†Œ ê²€ìƒ‰í•˜ê¸°</button>
          </div>
          <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px; text-align: center;">
            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ ì œê³µ</div>
            <a href="https://cx-tech-builder.netlify.app/" target="_blank" style="color: #222; text-decoration: none; font-weight: 500; font-size: 12px;">
              CX Tech Builder
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
    <div id="adminModal" class="modal">
      <div class="modal__backdrop" onclick="closeAdminModal()"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
        <div class="modal__header">
          <h2 id="adminTitle">ê´€ë¦¬ì</h2>
          <button type="button" id="adminClose" class="icon-btn" aria-label="ë‹«ê¸°">âœ–ï¸</button>
        </div>
        <div class="modal__body">
                    <section class="admin-section">
            <h3>ì£¼ë¬¸ ëª©ë¡ (ìµœê·¼ 3ì¼)</h3>
            <div style="margin-bottom: 16px; padding: 12px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; color: #856404; font-size: 14px;">
              <strong>ğŸ“‹ ë°ì´í„° ë³´ê´€ ì •ì±…:</strong> ì£¼ë¬¸ë‚´ì—­ì€ ì›í™œí•œ ì„œë²„ ê´€ë¦¬ë¥¼ ìœ„í•´ 3ì¼ì´ ì§€ë‚œ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. 
              <br>â€» Raw ë°ì´í„°ëŠ” ì…€ëŸ¬ê»˜ì„œ ë§¤ë²ˆ ì €ì¥í•˜ì—¬ ë³´ìœ í•´ ì£¼ì„¸ìš”.
            </div>
            <div class="table-wrap">
              <div class="table-wrap">
                <table class="table">
                  <thead>
                    <tr>
                      <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                      <th>ì£¼ë¬¸ì‹œê°„</th>
                      <th>ì…ê¸ˆìëª…</th>
                      <th>ì—°ë½ì²˜</th>
                      <th>êµ¬ë§¤ì œí’ˆ</th>
                      <th>ì£¼ì†Œ</th>
                      <th>ìƒì„¸ì£¼ì†Œ</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTbody"></tbody>
                </table>
              </div>
            </div>
            <div class="admin-actions">
                              <button type="button" id="btnExportExcel" style="background: #27ae60;">ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
            </div>
            <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; text-align: center;">
              <div style="font-size: 12px; color: #666; margin-bottom: 8px;">ì‹œìŠ¤í…œ ê°œë°œ</div>
              <a href="https://cx-tech-builder.netlify.app/" target="_blank" style="color: #222; text-decoration: none; font-weight: 500; font-size: 14px;">
                CX Tech Builder - ì‹¤ë¬´ ì¤‘ì‹¬ í’€ìŠ¤íƒ ê°œë°œì
              </a>
            </div>
          </section>


        </div>
      </div>
    </div>
    
    <!-- ê°œë°œì ì •ë³´ í‘¸í„° -->
    <footer style="margin-top: 40px; padding: 20px 0; border-top: 1px solid #eee; text-align: center; color: #666; font-size: 12px;">
      <div style="margin-bottom: 8px;">
        <span>Powered by </span>
        <a href="https://cx-tech-builder.netlify.app/" target="_blank" style="color: #222; text-decoration: none; font-weight: 500;">CX Tech Builder</a>
      </div>
      <div style="font-size: 11px; color: #999;">
        ì‹¤ë¬´ ì¤‘ì‹¬ í’€ìŠ¤íƒ ê°œë°œì | ì—…ë¬´ íš¨ìœ¨í™” ì†”ë£¨ì…˜
      </div>
    </footer>
  </body>
  <!-- ì£¼ì†Œ ì°¾ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</html>


